name: Windows.Triage.Collectors.RegistryHives
description: |
  System and user related Registry hives.

precondition: SELECT OS From info() where OS = 'windows'

reference:
  - https://github.com/EricZimmerman/KapeFiles

parameters:
  - name: triageTable
    default: |
      Type,Accessor,Glob
      ntuser.dat registry hive,ntfs,C:\Documents and Settings\*\ntuser.dat
      ntuser.dat registry hive,ntfs,C:\Users\*\ntuser.dat
      ntuser.dat registry transaction files,ntfs,C:\Documents and Settings\*\ntuser.dat.LOG*
      ntuser.dat registry transaction files,ntfs,C:\Users\*\ntuser.dat.LOG*
      UsrClass.dat registry hive,ntfs,C:\Users\*\AppData\Local\Microsoft\Windows\UsrClass.dat
      UsrClass.dat registry transaction files,ntfs,C:\Users\*\AppData\Local\Microsoft\Windows\UsrClass.dat.LOG*
      SAM registry transaction files,ntfs,C:\Windows\System32\config\SAM.LOG*
      SECURITY registry transaction files,ntfs,C:\Windows\System32\config\SECURITY.LOG*
      SYSTEM registry transaction files,ntfs,C:\Windows\System32\config\SYSTEM.LOG*
      SAM registry hive,ntfs,C:\Windows\System32\config\SAM
      SECURITY registry hive,ntfs,C:\Windows\System32\config\SECURITY
      SOFTWARE registry hive,ntfs,C:\Windows\System32\config\SOFTWARE
      SYSTEM registry hive,ntfs,C:\Windows\System32\config\SYSTEM
      RegBack registry transaction files,ntfs,C:\Windows\System32\config\RegBack\*.LOG*
      SAM registry hive (RegBack),ntfs,C:\Windows\System32\config\RegBack\SAM
      SECURITY registry hive (RegBack),ntfs,C:\Windows\System32\config\RegBack\SECURITY
      SOFTWARE registry hive (RegBack),ntfs,C:\Windows\System32\config\RegBack\SOFTWARE
      SYSTEM registry hive (RegBack),ntfs,C:\Windows\System32\config\RegBack\SYSTEM
      System Profile registry hive,ntfs,C:\Windows\System32\config\systemprofile\ntuser.dat
      System Profile registry transaction files,ntfs,C:\Windows\System32\config\systemprofile\ntuser.dat.LOG*
      Local Service registry hive,ntfs,C:\Windows\ServiceProfiles\LocalService\ntuser.dat
      Local Service registry transaction files,ntfs,C:\Windows\ServiceProfiles\LocalService\ntuser.dat.LOG*
      Network Service registry hive,ntfs,C:\Windows\ServiceProfiles\NetworkService\ntuser.dat
      Network Service registry transaction files,ntfs,C:\Windows\ServiceProfiles\NetworkService\ntuser.dat.LOG*
      System Restore Points Registry Hives (XP),ntfs,C:\System Volume Information\_restore*\RP*\snapshot\_REGISTRY_*

sources:
  - queries:
      - SELECT * FROM Artifact.Triage.Collection.UploadTable(
               triageTable=triageTable)
